(let (test-code (assemble '((PUSH 1)
                            (PUSH 2)
                            (CONS))))
  (prn "Running test bytecode:")
  (prn test-code)
  (prn (run-bytecode test-code)))

(let (test-code (assemble `((PUSH nil)
                            (PUSH 2)
                            (CONS)
                            (PUSH 2)
                            (CONS)
                            (CALL_BUILTIN ,+))))
  (prn "Running test bytecode:")
  (prn test-code)
  (prn (run-bytecode test-code)))

(let (test-code-func (assemble `((PUSH ("Print from called function."))
                                 (CALL_BUILTIN ,prn)
                                 (POP)
                                 (RET))))
  (let (test-code (assemble `((PUSH nil)
                              (PUSH nil)
                              (PUSH 2)
                              (CONS)
                              (PUSH 2)
                              (CONS)
                              (CALL_BUILTIN ,+)
                              (CALL ,test-code-func)
                              (PUSH ("Successfully returned."))
                              (CALL_BUILTIN ,prn))))
    (assert (sym= (type test-code-func) 'bytecode))
    (prn "Running test bytecode:")
    (prn test-code)
    (prn "Function to call:")
    (prn test-code-func)
    (prn (run-bytecode test-code))))

(let (test-code (assemble `((PUSH 2)
                            (PUSH 2)
                            (JEQ 5)
                            (PUSH "This should be skipped")
                            (CALL_BUILTIN ,prn)
                            (CALL_BUILTIN ,+))))
  (prn "Running test bytecode:")
  (prn test-code)
  (prn (run-bytecode test-code)))
